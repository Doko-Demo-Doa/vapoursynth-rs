sudo: required
language: rust
os:
  - linux
  - osx
rust:
- stable
- beta
- nightly
matrix:
  allow_failures:
  - rust: nightly
env:
  global:
  - RUST_BACKTRACE=1
cache: cargo

before_install:
- bash .travis/install-vapoursynth.sh

script:
  # Build and test with no features.
- cargo build --verbose
- cargo test --verbose

  # Build with all features.
- cargo build --verbose --all-features

  # Doc with all features.
- cargo doc --verbose --all-features
- cp .travis/index.html target/doc/

  # Test with all possible combinations of all features.
- cd vapoursynth; python3 ../.travis/run-tests.py

deploy:
  provider: pages
  skip_cleanup: true
  github_token: "$GITHUB_TOKEN"
  local_dir: target/doc
  on:
    branch: master
    rust: stable
    condition: $TRAVIS_OS_NAME = linux
